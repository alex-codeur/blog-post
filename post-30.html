<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/style.css">
    <title>Blog</title>
</head>

<body>
    <div class="container">
        <h1>Nodejs et MongoDB : comment utiliser MongoDB sur une application Node ?
        </h1>

        <h4>Table des mati√®res</h4>

        <ul>
            <li>Node.js-MongoDB: connecter votre app √† la base Mongo</li>
            <li>Nodejs MongoDB: Connecter votre app avec MongoClient
            </li>
            <li>Connecter votre app avec</li>
            <li>Cr√©er la connexion Nodejs MongoDB avec Mongoose</li>
            <li>Node MongoDB: quel client utiliser ?</li>
            <li>Aller plus loin:</li>
        </ul>

        <p>MongoDB est l'√©diteur dominant dans le segment des bases de donn√©es orient√©es documents, voir dans tout le
            segment des bases NoSQL. Sa simplicit√© d'utilisation, sa flexibilit√© et sa large adoption en ont fait la
            technologie base de donn√©es la plus adopt√©e pour les nouveaux projets qui n'ont pas une raison √©vidente pour
            partir sur une base de donn√©es SQL. Pour les applications nodejs mongodb est l'outil parfait pour du
            prototypage.</p>

        <div class="jumbotron">
            {
            "_id":"5beca8f00000000000000000",
            "name": "Rayed",
            "contacts": {
            "tel":"+123456789",
            "email":"rayed@email.com"
            },
            "status":"en poste"
            }
        </div>

        <p>Dans une base mongoDB, vos donn√©es sont stock√©es sous forme d'objets JSON. Dans la majorit√© des cas,
            l'ensemble des donn√©es li√©es √† cet objet se trouvent dans un seul document, contrairement aux bases SQL o√π
            il faut faire des jointures sur diff√©rentes tables afin d'assembler un document.

            üßë‚Äçüéì Vous souhaitez apprendr</p>

        <h3>Node.js-MongoDB: connecter votre app √† la base Mongo</h3>

        <p>Pour utiliser MongoDB, vous pouvez l'installer sur votre machine ou utiliser une image docker pour une
            utilisation en local. Vous pouvez √©galement utiliser une solution cloud de Database as a Service, telle que
            MongoDB Atlas.</p>

        <h4>Nodejs MongoDB: Connecter votre app avec MongoClient</h4>

        <h5>Connecter votre app Express √† MongoDB avec mongodb</h5>

        <p>Commencez par ajouter le mongodb √† votre projet en saisissant la commande npm install mongodb dans votre
            terminal √† la racine de votre projet.</p>

        <p>Dans votre fichier index.js (ou le fichier o√π vous d√©marrez votre serveur express), ajoutez le code suivant
            avant le lancement de votre serveur:</p>

        <div class="jumbotron">
            const MongoClient = require('mongodb').MongoClient;

            const url = 'mongodb://localhost:27017'
            const dbName = 'monProjetMongo';

            MongoClient.connect(url, function(err, client) {
            console.log("Connect√© √† MongoDB");
            const db = client.db(dbName);
            client.close();
            });
        </div>

        <p>En relan√ßant votre application Nodejs, vous devriez voir dans votre terminal "Connect√© √† MongoDB" si votre
            connection est bien √©tablie.</p>

        <h4>Ex√©cuter des requ√™tes Mongo via votre application Node.js</h4>

        <p>Votre base de donn√©es maintenant connect√©e, vous pouvez cr√©er les op√©rations mongoDB pour cr√©er, lire,
            modifier ou effacer un document. Avec le client mongo, vous op√©rerez directement avec les commandes d√©finies
            par MongoDB.</p>

        <p>Voici un exemple de la cr√©ation d'un document:</p>

        <div class="jumbotron">
            const createStudent = async object => {
            const collection = db.collection('students');
            const student = await collection.insertOne(object);
            return student
            }

            const newStudent = {
            name:"rayed",
            status:"√©tudiant"
            }

            const insertStudent = await createStudent(newStudent)
            console.log(newStudent)
        </div>

        <p>Dans cet exemple, la fonction createStudent va se charger d'ins√©rer dans la collection Student l'objet que
            vous passerez en param√®tre. Apr√®s avoir d√©fini cette fonction et le nouvel √©tudiant que je voulais ins√©rer,
            j'appelle la fonction createStudent en lui passant cet √©tudiant en param√®tre.</p>

        <h4>Connecter votre app avec Mongoose</h4>

        <p>Contrairement √† MongoClient, mongoose est une fine surcouche √† MongoDB qui simplifie certaines op√©rations et
            qui impose la structure des objets via des schemas. En effet, lorsque vous manipulez MongoDB directement,
            vous √™tes libres d'ins√©rer n'importe quel document dans une collection. Avec Mongoose, vous d√©finissez des
            Schemas qui imposent les champs que doivent contenir les objets issus de ce schema.</p>

        <div class="jumbotron">
            const studentSchema = new Schema({
            email:{
            type: String,
            required: true,
            unique: true
            },
            github: {
            type:String,
            lowercase:true
            },
            first_name:String
            })
        </div>

        <p>Dans l'exemple, nous avons un schema o√π un objet Student pourra contenir les champs email, github et
            first_name. Il ne pourra pas contenir de champs absents du schema. En revanche il pourrait avoir uniquement
            le champs email, car lui seul est obligatoire</p>

        <h4>Cr√©er la connexion Nodejs MongoDB avec Mongoose</h4>

        <p>Comme pour MongoClient, installez mongoose sur votre projet via la commande npm install mongoose</p>

        <p>Avant le lancement de votre serveur, ajoutez le code suivant:</p>

        <div class="jumbotron">
            const mongoose = require('mongoose');

            mongoose.connect('mongodb://localhost:27017/test', {useNewUrlParser: true, useUnifiedTopology: true});

            db = mongoose.connection;
            db.on('error', console.error.bind(console, 'connection error:'));
            db.once('open', function() {
            console.log("connect√© √† Mongoose")
            });
        </div>

        <p>En relan√ßant votre serveur Nodejs, vous devriez voir dans votre terminal "connect√© √† Mongoose" si votre
            connexion est bien √©tablie. Dans le cas contraire, un message contenant l'erreur si la connexion n'a pas pu
            se faire.</p>

        <h5>Ex√©cuter des requ√™tes avec mongoose</h5>

        <p>Contrairement √† MongoClient, Mongoose vous oblige √† d√©finir vos schemas avant de manipuler vos objets.
            Commen√ßons par cr√©er un premier schema dans un fichier student.js.</p>

        <div class="jumbotron">
            const mongoose = require('mongoose');
            const Schema = mongoose.Schema;

            const studentSchema = new Schema({
            firstName: String,
            lastName: String,
            cursus: String,
            classes: [{ body: String, date: Date }],
            enrolled: { type: Date, default: Date.now }
            });

            const Student = mongoose.model('Student', studentSchema)

            module.exports = Student
        </div>

        <p>Ce fichier va contenir le module Student, qui est un schema mongoose. Nous avons les propri√©t√©s qu'un student
            peut contenir.</p>

        <p>Une fois ce schema d√©fini, vous pouvez maintenant utiliser les m√©thodes des schemas mongoose pour r√©aliser
            nos op√©rations de cr√©ation, modification ou suppression.</p>

        <div class="jumbotron">
            const Student = require('./student.js')

            // Cr√©er un √©tudiant
            const createStudent = async studentData => {
            const student = await Student.create(studentData)
            return student
            }

            // R√©cup√©rer un √©tudiant
            const findStudent = async firstName => {
            const student = await Student.findOne({firstName})
            return student
            }

            // R√©cup√©rer tous les √©tudiants
            const findStudents = async firstName => {
            const student = await Student.find({})
            return student
            }
        </div>

        <p>Vous trouverez ici la liste des queries possibles pour manipuler vos objets via mongoose.</p>

        <h5>Node MongoDB: quel client utiliser ?</h5>

        <p>Dans la plupart des cas, je vous conseille d'utiliser Mongoose pour vos projets d'application nodejs MongoDB.
            Cette librairie va vous permettre d'imposer une structure √† vos donn√©es tout en simplifiant les requ√™tes.
        </p>

        <p>En revanche, si vous cherchez √† prototyper quelque chose ou que vous souhaitez pratiquer vos comp√©tences
            MongoDB alors mongoClient vous permet d'√™tre au plus pr√™t de la base de donn√©es et de manipuler les requ√™tes
            natives de mongo.</p>
    </div>
</body>

</html>